---
title: "final_project"
author: "Caroline Behrens"
date: "4/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rstanarm)
library(ggthemes)
library(ggdist)
library(gt)
library(janitor)
library(broom.mixed)
library(gtsummary)
library(tidybayes)
```

```{r}
library(readr)
crime_data <-  read_csv("prison/raw_data/crime_and_incarceration_by_state.csv")
View(crime_and_incarceration_by_state)
```


```{r}
mortality_data <- msfp0116stt12 <- read_csv("Prison/raw_data/msfp0116stt12.csv")
View(msfp0116stt12)
```

```{r}
total_mortality <- mortality_data %>%
  rename(jurisdiction = `State/Federal`) %>%
 filter(!(jurisdiction %in% c("Federal", "State"))) %>%
  select(-"2001 caveat", -"2006 caveat", -"2007 caveat", -"2008 caveat", -"2009 caveat",
         -"2010 caveat", -"2011 caveat", -"2012 caveat", -"2013 caveat", -"2014 caveat",
         -"2015 caveat", -"2016 caveat")
```


```{r}
total_mortality %>%
  pivot_longer(names_to = "year",
               values_to = "Mortality_Count",
               cols =  `2001` : `2016`)

```


```{r}
 crime_and_incarceration_by_state <- crime_data %>%
  mutate(jurisdiction = str_to_title(jurisdiction)) %>%
  filter(jurisdiction != "Federal")

```

```{r}
state_crime <- crime_and_incarceration_by_state %>%
  sample_n(1000, replace = TRUE) %>%
  mutate(name = str_to_sentence(jurisdiction)) %>%
inner_join(total_mortality, by = "jurisdiction") %>%
  select(name, year, violent_crime_total,agg_assault, 
murder_manslaughter, robbery, property_crime_total,
larceny, vehicle_theft) %>%
  pivot_longer(names_to = "type",
               values_to = "total",
               cols = c(property_crime_total, violent_crime_total))

state_crime
```




```{r}
clean_crime <- crime_and_incarceration_by_state %>%
 mutate(south = ifelse(jurisdiction %in% c("Alabama", "Florida", "Georgia", "Kentucky",
                                            "Louisiana", "Maryland", "Mississippi",
                                            "North Carolina", "Oklahoma", "South Carolina",
                                            "Tennesse", "Texas", "Virginia", "West Virginia"),
                        TRUE, FALSE)) %>%
  mutate(population_in_thousands = state_population/1000) %>%
  mutate(prisoner_count_in_thousands = prisoner_count/1000) %>%
  mutate(violent_crime_in_thousands = violent_crime_total/1000) %>%
  drop_na(population_in_thousands) %>%
  drop_na(prisoner_count_in_thousands) %>%
  drop_na(violent_crime_in_thousands)
```

```{r}
fit_1 <- stan_glm(prisoner_count_in_thousands ~ population_in_thousands + south + violent_crime_in_thousands + south*violent_crime_in_thousands,
                  data = clean_crime, 
                  seed = 17,
                  refresh = 0)
print(fit_1, digits = 4)
```
*section 6.3*
*chapter 9* 

```{r}
fit_prisoner <-tbl_regression(fit_1,
               intercept = TRUE,
               estimate_fun = function(x) style_sigfig(x, digits = 3)) %>%
  as_gt() %>%
    tab_header(title = "Prisoner Count Varies Greatly by Population", 
               subtitle = "Southern States Have More Crime  ") %>%
    tab_source_note(md("Source: "))

fit_prisoner

write_rds(fit_prisoner, "some-path/my_fit.rds")
```




```{r}
population_in_thousands <- unique(clean_crime$population_in_thousands)
south <- unique(clean_crime$south)
violent_crime_in_thousands <- unique(clean_crime$violent_crime_in_thousands)

newobs_1 <- expand_grid(population_in_thousands, south, violent_crime_in_thousands)
```

```{r}
real_p <-add_fitted_draws(newobs_1, fit_1)
```




```{r}
mortality_numbers <- total_mortality %>%
  pivot_longer(names_to = "Year",
               values_to = "Mortality_Number",
               cols = c(`2001`, `2006`, `2007`, `2008`, `2009`,`2010`, `2011`, `2012`,
               `2013`, `2014`,`2015`,`2016`)) %>%
  mutate(south = ifelse(jurisdiction %in% c("Alabama", "Florida", "Georgia", "Kentucky",
                                            "Louisiana", "Maryland", "Mississippi",
                                            "North Carolina", "Oklahoma", "South Carolina",
                                            "Tennesse", "Texas", "Virginia", "West Virginia"),
                        TRUE, FALSE))
```


```{r}
#mortality_numbers %>%
  #ggplot(aes(x = "mortality_number",y = , fill = south)) + 
 # geom_point(alpha = 0.05) + 
 # geom_smooth()


mortality_plot <- ggplot(data = mortality_numbers, 
       mapping = aes(x = Mortality_Number, 
                     y = Year, 
                     color = south)) +
  geom_point(alpha = 0.5) 
  
mortality_plot
```

